<!DOCTYPE HTML>

<html lang='en'>
	<head>
		<title>è¿‘æœŸä½¿ç”¨Dockeræ‰“åŒ…é•œåƒé‡åˆ°çš„é—®é¢˜æ€»ç»“ &middot; Yeqown</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		
		
		
		<link rel="stylesheet" href="/assets/css/main.min.css">
		
		
		<link rel="shortcut icon" href="favicon.ico">
		
		
		<noscript><link rel="stylesheet" href='/assets/css/noscript.css' /></noscript>
		<link rel="stylesheet" href="/highlight/styles/monokai-sublime.css">
		
		<script src="/highlight/highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</head>
	<body lang='en' class="is-preload">

		
			<div id="wrapper">

                
<header id="header">
    <a href='/' class="logo">Yeqown</a>
</header>

                

<nav id="nav">
    <ul class="links">
        <li class="active"><a href='/'>Yeqown</a></li>
        
        <li><a href='/#footer'>Contact</a></li>
        
        
    </ul>
    
    <ul class="icons">
        
        <li><a href="https://twitter.com/yeqown" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
        
        
        
        
        
        <li><a href="https://github.com/yeqown" class="icon fa-github"><span class="label">GitHub</span></a></li>
        
        
        
        
        
    </ul>
    
</nav>


				
					<div id="main">

						
                        <section class="post">
                            <header class="major">
                                
                                <span class="date">August 12, 2020</span>
                                
                                <h1>è¿‘æœŸä½¿ç”¨Dockeræ‰“åŒ…é•œåƒé‡åˆ°çš„é—®é¢˜æ€»ç»“</h1>
                                <p>æ€»ç»“æœ€è¿‘ä½¿ç”¨dockeré‡åˆ°çš„é—®é¢˜å’Œè§£å†³åŠæ³•ã€‚</p>
                            </header>
                            
                            <h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>
<p>åœ¨ <a href="https://github.com/yeqown/goreportcard">github.com/yeqown/goreportcard</a> é¡¹ç›®ä¸­æˆ‘æ”¹é€ äº† <code>goreportcard</code>ã€‚
åç»­ä¸ºäº†æ–¹ä¾¿éƒ¨ç½²ï¼Œæˆ‘å‡†å¤‡å°†å…¶æ‰“åŒ…æˆä¸ºdockeré•œåƒå¹¶ä¸Šä¼ åˆ° <code>DockerHub</code>ã€‚æœŸé—´é‡åˆ°äº†ä¸‹é¢çš„é—®é¢˜ï¼Œå¹¶ä¸€ä¸€è§£å†³ï¼Œè¿™é‡Œåšä¸€ä¸ªè®°å½•å¸®åŠ©ä»¥åé‡åˆ°ç±»ä¼¼çš„é—®é¢˜å¯ä»¥å¿«é€Ÿè§£å†³ã€‚</p>
<p>åˆæœŸçš„ç›®æ ‡æ˜¯ï¼šå°†<code>goreportcard</code>å’Œ<code>golangci-lint</code>ç¼–è¯‘å¥½ï¼Œå°½å¯èƒ½è¾ƒå°é•œåƒçš„ä½“ç§¯ã€‚å› æ­¤ç¬¬ä¸€æ¬¡å°è¯•ï¼Œæˆ‘ä½¿ç”¨äº†åˆ†é˜¶æ®µç¼–è¯‘ï¼Œç”¨<code>golang:1.14.1</code>ç¼–è¯‘ï¼Œ<code>alpine</code>æ¥å‘å¸ƒã€‚</p>
<p>åŸºæœ¬ Dockerfile å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#75715e"># building stage</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> golang:1.14-alpine3.11 as build</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /tmp/build</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> . .<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> export GOPROXY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://goproxy.cn,direct&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> go mod download <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> go build -o app ./cmd/goreportcard-cli/ <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> go get github.com/golangci/golangci-lint <span style="color:#f92672">&amp;&amp;</span> go install github.com/golangci/golangci-lint/cmd/golangci-lint<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># release stage</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> golang:1.14-alpine3.11 as release</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /app/goreportcard</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>build /tmp/build/app .<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>build /tmp/build/tpl ./tpl<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>build /tmp/build/assets ./assets<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># FIXED: ä¸èƒ½ä½¿ç”¨golangci-lint, `File not found` é”™è¯¯</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> --from<span style="color:#f92672">=</span>build /go/bin/golangci-lint /usr/local/bin<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 8000</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> [<span style="color:#e6db74">&#34;./app&#34;</span>, <span style="color:#e6db74">&#34;start-web&#34;</span>, <span style="color:#e6db74">&#34;&amp;&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h3 id="é—®é¢˜æ¸…å•å’Œè§£å†³æ–¹æ¡ˆ">é—®é¢˜æ¸…å•å’Œè§£å†³æ–¹æ¡ˆ</h3>
<blockquote>
<p>ç”±äºå¹¶ä¸æ˜¯æ‰€æœ‰çš„é—®é¢˜éƒ½å’ŒDockeræœ‰å…³ï¼Œå› æ­¤æˆ‘ä¼šä½¿ç”¨ <code>[åˆ†ç±»]</code> åœ¨æ ‡é¢˜ä¸Šæ³¨æ˜ã€‚</p>
</blockquote>
<h4 id="0-å¦‚ä½•è°ƒè¯•dockeræ‰“åŒ…è¿‡ç¨‹-docker">0. å¦‚ä½•è°ƒè¯•Dockeræ‰“åŒ…è¿‡ç¨‹ <code>[Docker]</code></h4>
<p>åœ¨Dockeræ‰“åŒ…è¿‡ç¨‹ä¸­ä¼šæœ‰å¦‚ä¸‹å­—æ ·ï¼Œå…¶ä¸­<code>---&gt; 5d5cac8457ad</code> å­—æ ·å°±æ˜¯ä¸€ä¸ªå¯ä»¥è¿è¡Œçš„é•œåƒï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°è¯•è¿è¡Œè¿™ä¸ªé•œåƒæ¥è·å–æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ï¼Œ
è€Œä¸ç”¨åœ¨ <code>Dockerfile</code> ä¸­é€šè¿‡ <code>echo</code> æ¥DebugğŸ¶ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker build -t goreportcard:v1.0.0 .
Sending build context to Docker daemon  12.08MB
Step 1/13 : FROM golang:1.14-alpine3.11 as build
 ---&gt; 5d5cac8457ad
Step 2/13 : WORKDIR /tmp/build
 ---&gt; Using cache
 ---&gt; c57b9255d5fb
Step 3/13 : COPY . .
</code></pre></div><p>è¿è¡Œæ‰“åŒ…è¿‡ç¨‹ä¸­çš„é•œåƒ</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker run -it c57b9255d5fb
</code></pre></div><h4 id="1-golangci-lint-ç¼–è¯‘å¥½åå¤åˆ¶åˆ°-alpineä¸­æ— æ³•è¿è¡Œgo">1 golangci-lint ç¼–è¯‘å¥½åå¤åˆ¶åˆ° alpineä¸­æ— æ³•è¿è¡Œï¼Ÿ<code>[Go]</code></h4>
<p>é‡åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œæç¤ºé”™è¯¯ä¿¡æ¯å¤§è‡´ä¸º<code>File or Path not found</code>ï¼Œä½†åŒæ—¶ <code>goreportcard</code> æ˜¯å¯ä»¥è¿è¡Œï¼Œè¿™ä¸¤è€…æ˜¯åœ¨ç›¸åŒåœ°ç¯å¢ƒä¸‹ç¼–è¯‘å‡ºæ¥çš„ã€‚
å› æ­¤è‚¯å®šæ˜¯ç¼–è¯‘çš„æ—¶å€™å­˜åœ¨å·®å¼‚ï¼Œåˆæ­¥åˆ¤æ–­ä¸º<code>CGO_ENABLEDï¼ŒGOOSï¼ŒGOARCH</code>ä¸‰ä¸ªå˜é‡ï¼Œé€šè¿‡æœç´¢å’Œå°è¯•æœ€ç»ˆç»Ÿä¸€å¢åŠ è¿™ä¸‰ä¸ªç¯å¢ƒå˜é‡è§£å†³é—®é¢˜ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">    <span style="color:#f92672">&amp;&amp;</span> export CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> export GOARCH<span style="color:#f92672">=</span>amd64 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> export GOOS<span style="color:#f92672">=</span>linux <span style="color:#ae81ff">\
</span></code></pre></div><h4 id="2-golangci-lint-éœ€è¦goå¯æ‰§è¡Œæ–‡ä»¶-go">2. golangci-lint éœ€è¦<code>Go</code>å¯æ‰§è¡Œæ–‡ä»¶? <code>[Go]</code></h4>
<p>// TODO:</p>
<h4 id="3-go-get-éœ€è¦-git--ssh-å®¢æˆ·ç«¯-go">3. <code>go get</code> éœ€è¦ <code>git</code> / <code>ssh</code> å®¢æˆ·ç«¯ï¼Ÿ <code>[Go]</code></h4>
<p>// TODO:</p>
<h4 id="4-åœ¨-alpine-ä¸­å¦‚ä½•å®‰è£…é¢„ç¼–è¯‘å¥½çš„è½¯ä»¶å¦‚git-docker">4. åœ¨ alpine ä¸­å¦‚ä½•å®‰è£…é¢„ç¼–è¯‘å¥½çš„è½¯ä»¶ï¼Œå¦‚gitï¼Ÿ <code>[Docker]</code></h4>
<p>è¿™ä¸ªæ˜¯åœ¨<code>git</code>çš„ <a href="https://git-scm.com/download/linux">linuxå®‰è£…å¸®åŠ©</a> é‡Œæ‰¾åˆ°çš„ğŸ˜‚ï¼Œä¹Ÿä¸çŸ¥é“ä¸ºå•¥ï¼Œåªèƒ½å¤¸ä¸‹<code>git</code>å¯çœŸä¸“ä¸š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">apk add git
</code></pre></div><h4 id="5-åœ¨-alpine-ä¸­å®‰è£…è½¯ä»¶ç‰¹åˆ«æ…¢å¦‚ä½•è§£å†³--docker">5. åœ¨ alpine ä¸­å®‰è£…è½¯ä»¶ç‰¹åˆ«æ…¢ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ  <code>[Docker]</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sed -i <span style="color:#e6db74">&#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&#39;</span> /etc/apk/repositories
</code></pre></div><h4 id="6-é•œåƒä¸­-go-get-æ€ä¹ˆä½¿ç”¨å®¿ä¸»çš„ç¼“å­˜--godocker">6. é•œåƒä¸­ <code>go get</code> æ€ä¹ˆä½¿ç”¨å®¿ä¸»çš„ç¼“å­˜ï¼Ÿ  <code>[Go+Docker]</code></h4>
<p>æŠŠå®¿ä¸»æœºçš„ <code>path/go/pkg</code> æŒ‚è½½åˆ° <code>/go/pkg</code>ï¼Œè¿™é‡Œé»˜è®¤ä½¿ç”¨çš„æ˜¯goçš„å®¹å™¨é•œåƒã€‚</p>
<h4 id="7-could-not-import-c-no-metadata-for-c-go">7. could not import C (no metadata for C) <code>[Go]</code></h4>
<p><a href="https://github.com/golangci/golangci-lint/issues/602">https://github.com/golangci/golangci-lint/issues/602</a></p>


                            
                            
                            
                            
                            
                        </section>

					</div>

                    

<footer id="footer">
    
    <section>
      <form method="post" action="post-action">
        <div class="fields">
          <div class="field">
            <label for="name">Name</label>
            <input type="text" name="name" id="name" />
          </div>
          <div class="field">
            <label for="email">Email</label>
            <input type="text" name="email" id="email" />
          </div>
          <div class="field">
            <label for="message">Message</label>
            <textarea name="message" id="message" rows="3"></textarea>
          </div>
        </div>
        <ul class="actions">
          <li><input type="submit" value='Send A Message' /></li>
        </ul>
      </form>
    </section>
    
    <section class="split contact">
        
        <section class="alt">
            <h3>Address</h3>
            <p>
                
                     Chengdu Â· China
                
                     <br/>  This is a city that comes and doesn&#39;t want to go
                
            </p>
        </section>
        
        
        <section>
            <h3>Phone</h3>
            <p><a href="tel:no%20way">no way</a></p>
        </section>
        
        
        <section>
            <h3>Email</h3>
            <p><a href="mailto:yeqown@gmail.com">yeqown@gmail.com</a></p>
        </section>
        
        
        <section>
            <h3>Social</h3>
            <ul class="icons alt">
                
                <li><a href="https://twitter.com/yeqown" class="icon alt fa-twitter"><span class="label">Twitter</span></a></li>
                
                
                
                
                
                <li><a href="https://github.com/yeqown" class="icon alt fa-github"><span class="label">GitHub</span></a></li>
                
                
                
                
                
            </ul>
        </section>
        
    </section>
</footer>

                    
<div id="copyright">
    <ul><li>&copy; Yeqown</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li><li>Hugo Port: <a href="https://curtistimson.co.uk">curttimson</a></li></ul>
</div>


            </div>
            
            










<script src='/assets/js/bundle.js'></script>
	</body>
</html>
