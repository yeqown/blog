<!DOCTYPE HTML>

<html lang='en'>
	<head>
		<title>Ginæºç ç®€è¦åˆ†æ &middot; Yeqown</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		
		
		
		<link rel="stylesheet" href="/assets/css/main.min.css">
		
		
		<link rel="shortcut icon" href="favicon.ico">
		
		
		<noscript><link rel="stylesheet" href='/assets/css/noscript.css' /></noscript>
		<link rel="stylesheet" href="/highlight/styles/monokai-sublime.css">
		
		<script src="/highlight/highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</head>
	<body lang='en' class="is-preload">

		
			<div id="wrapper">

                
<header id="header">
    <a href='/' class="logo">Yeqown</a>
</header>

                

<nav id="nav">
    <ul class="links">
        <li class="active"><a href='/'>Yeqown</a></li>
        
        <li><a href='/#footer'>Contact</a></li>
        
        
    </ul>
    
    <ul class="icons">
        
        <li><a href="https://twitter.com/yeqown" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
        
        
        
        
        
        <li><a href="https://github.com/yeqown" class="icon fa-github"><span class="label">GitHub</span></a></li>
        
        
        
        
        
    </ul>
    
</nav>


				
					<div id="main">

						
                        <section class="post">
                            <header class="major">
                                
                                <span class="date">January 21, 2020</span>
                                
                                <h1>Ginæºç ç®€è¦åˆ†æ</h1>
                                <p>ç®€å•ä»‹ç»ginæºç ï¼Œä¸»è¦æ˜¯è·¯ç”±å’Œä¸­é—´ä»¶çš„ç›¸å…³ç»‘å®šä½¿ç”¨æµç¨‹ï¼Œä»¥åŠContextè®¾è®¡ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬render</p>
                            </header>
                            
                            <h3 id="æ¦‚è¿°">æ¦‚è¿°</h3>
<p>é€šè¿‡æ—¥å¸¸å¯¹ginåœºæ™¯å‡ºå‘ï¼Œæ·±å…¥æºç ï¼Œæ€»ç»“ä»‹ç»ginçš„æ ¸å¿ƒè®¾è®¡ã€‚åŒ…å«ï¼šEngine / HandlerFunc / RouterGroup(Router) / Contextã€‚åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­å¸¸è§çš„å°±ä»¥ä¸Šæ¦‚å¿µï¼Œæ±‡æ€»å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>è§£é‡Š</th>
<th>åº”ç”¨æ„ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>Engine</td>
<td>å¼•æ“</td>
<td>web serverçš„åŸºç¡€æ”¯æŒï¼Œä¹Ÿæ˜¯æœåŠ¡çš„å…¥å£ å’Œ æ ¹çº§æ•°æ®ç»“æ„</td>
</tr>
<tr>
<td>RouterGroup(Router)</td>
<td>è·¯ç”±</td>
<td>ç”¨äºæ”¯æŒgin,RESTè·¯ç”±ç»‘å®šå’Œè·¯ç”±åŒ¹é…çš„åŸºç¡€ï¼Œæºäºradix-treeæ•°æ®ç»“æ„æ”¯æŒ</td>
</tr>
<tr>
<td>HandlerFunc</td>
<td>å¤„ç†å‡½æ•°</td>
<td>é€»è¾‘å¤„ç†å™¨å’Œä¸­é—´ä»¶å®ç°çš„å‡½æ•°ç­¾å</td>
</tr>
<tr>
<td>Context</td>
<td>ä¸Šä¸‹æ–‡</td>
<td>å°è£…äº†è¯·æ±‚å’Œå“åº”çš„æ“ä½œï¼Œä¸ºHandlerFuncçš„å®šä¹‰å’Œä¸­é—´ä»¶æ¨¡å¼æä¾›æ”¯æŒ</td>
</tr>
</tbody>
</table>
<h3 id="ä»demoå¼€å§‹">ä»DEMOå¼€å§‹</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">barForm</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">Foo</span> <span style="color:#66d9ef">string</span>  <span style="color:#e6db74">`form:&#34;foo&#34; binding:&#34;required&#34;`</span>
    <span style="color:#a6e22e">Bar</span> <span style="color:#66d9ef">int</span>     <span style="color:#e6db74">`form:&#34;bar&#34; binding:&#34;required&#34;`</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">fooHdl</span> <span style="color:#a6e22e">FooHdl</span>) <span style="color:#a6e22e">Bar</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">bform</span> = new(<span style="color:#a6e22e">barForm</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">ShouldBind</span>(<span style="color:#a6e22e">bform</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#75715e">// true: parse form error
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span>
    }

    <span style="color:#75715e">// handle biz logic and generate response structure
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// c (gin.Context) methods could called to support process-controling
</span><span style="color:#75715e"></span>
    <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#a6e22e">resp</span>)
    <span style="color:#75715e">// c.String() alse repsonse to client
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">// mountRouters .
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">mountRouters</span>(<span style="color:#a6e22e">engi</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Engine</span>) {
    <span style="color:#75715e">// use middlewares
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">engi</span>.<span style="color:#a6e22e">Use</span>(<span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Logger</span>())
    <span style="color:#a6e22e">engi</span>.<span style="color:#a6e22e">Use</span>(<span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Recovery</span>())
    
    <span style="color:#75715e">// mount routers
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">group</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">engi</span>.<span style="color:#a6e22e">Group</span>(<span style="color:#e6db74">&#34;/v1&#34;</span>)
    {
        <span style="color:#a6e22e">fooHdl</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">demohtp</span>.<span style="color:#a6e22e">New</span>()
        <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/foo&#34;</span>, <span style="color:#a6e22e">fooHdl</span>.<span style="color:#a6e22e">Bar</span>)
        <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/echo&#34;</span>, <span style="color:#a6e22e">fooHdl</span>.<span style="color:#a6e22e">Echo</span>)
        <span style="color:#75715e">// subGroup := group.Group(&#34;/subg&#34;)
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// subGroup.GET(&#34;/hdl1&#34;, fooHdl.SubGroupHdl1) // æœ€ç»ˆè·¯ç”±ï¼š&#34;targetURI = /v1/subg/hdl1&#34;
</span><span style="color:#75715e"></span>    }
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#a6e22e">engi</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">New</span>()

    <span style="color:#a6e22e">mountRouters</span>(<span style="color:#a6e22e">engi</span>)

    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">engi</span>.<span style="color:#a6e22e">Run</span>(<span style="color:#e6db74">&#34;:8080&#34;</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;engi exit with err=%v&#34;</span>, <span style="color:#a6e22e">err</span>)
    }
}
</code></pre></div><p>é€šè¿‡ä¸Šè¿°çš„ä»£ç å°±ç®€å•å¼€å¯äº†ä¸€ä¸ªgin serverï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº†å¸¸è§çš„ï¼šè·¯ç”±æ³¨å†Œï¼Œä¸­é—´ä»¶æ³¨å†Œï¼Œè·¯ç”±åˆ†ç»„ï¼ŒæœåŠ¡å¯åŠ¨ã€‚æ ¸å¿ƒæ¦‚å¿µä¹Ÿå°±æ˜¯åˆšåˆšåœ¨ä¸Šæ–‡æåˆ°çš„é‚£å››ä¸ªæ¦‚å¿µã€‚æ¦‚è§ˆæµç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<img src="/images/gin-full-view.png"/>
<p>å¯ä»¥å‚ç…§DEMOä¸­çš„æ–¹æ³•ååœ¨å›¾ä¸­æ£€ç´¢æ”¹æµç¨‹ã€‚</p>
<h3 id="engine">Engine</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Engine is the framework&#39;s instance, it contains the muxer, middleware and configuration settings.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Engine</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#75715e">// è·¯ç”±ç®¡ç†
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">RouterGroup</span>

    <span style="color:#75715e">// çœç•¥éå…³å¿ƒå±æ€§
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// context pooï¼Œæ”¯æŒcontextå¤ç”¨ï¼Œå‡å°‘å¯¹è±¡åˆ›å»ºæé«˜æ€§èƒ½ã€‚
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">pool</span>             <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Pool</span>
    
    <span style="color:#75715e">// []methodTreeæ–¹æ³•æ ‘æ ¹èŠ‚ç‚¹é›†åˆ è¿™éƒ¨åˆ†åœ¨è·¯ç”±éƒ¨åˆ†ä¼šè¯¦ç»†ä»‹ç»
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">trees</span>            <span style="color:#a6e22e">methodTrees</span> 
}

</code></pre></div><p>Engineæ˜¯æ ¹å…¥å£ï¼Œå®ƒæŠŠRouterGroupç»“æ„å›¾ä½“åµŒå…¥è‡ªèº«ï¼Œä»¥è·å¾—äº†Groupï¼ŒGETï¼ŒPOSTç­‰è·¯ç”±ç®¡ç†æ–¹æ³•ã€‚ä» <code>Run</code>æ–¹æ³•çš„ä»£ç ï¼š</p>
<blockquote>
<p>å› ä¸ºç›´æ¥å¤åˆ¶ä»£ç å¤ªå¤šäº†ï¼Œæ¨èä¸‹è½½æºç æ¥è·³è½¬ï¼Œæ›´ä¾¿æ·é«˜æ•ˆã€‚</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Engine</span>) <span style="color:#a6e22e">Run</span>(<span style="color:#a6e22e">addr</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() { <span style="color:#a6e22e">debugPrintError</span>(<span style="color:#a6e22e">err</span>) }()

    <span style="color:#a6e22e">address</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">resolveAddress</span>(<span style="color:#a6e22e">addr</span>)
    <span style="color:#a6e22e">debugPrint</span>(<span style="color:#e6db74">&#34;Listening and serving HTTP on %s\n&#34;</span>, <span style="color:#a6e22e">address</span>)
    <span style="color:#75715e">// ä½¿ç”¨çš„æ˜¯æ ‡å‡†åº“çš„httpæœåŠ¡å¯åŠ¨æ–¹æ³•
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// å¦‚æœçœ‹è¿‡http.ListenAndServeå‡½æ•°ç­¾åï¼Œå°±çŸ¥é“engineå®ç°äº†http.Handleræ–¹æ³•ï¼Œ
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ä¹Ÿå°±æ˜¯å®ƒä¸€å®šæœ‰ä¸€ä¸ªServeHTTPæ–¹æ³•
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#a6e22e">address</span>, <span style="color:#a6e22e">engine</span>)
    <span style="color:#66d9ef">return</span>
}
</code></pre></div><p>é€šè¿‡å±‚å±‚è·³è½¬æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å›¾ä¸­æ·¡ç´«è‰²éƒ¨åˆ†ä¸­çš„<code>handlerHTTPRequest</code>æ–¹æ³•ï¼Œåœ¨ServeHTTPå‡½æ•°æ—¶ï¼Œengineä¼šä»poolä¸­å–å¾—ä¸€ä¸ªContextå¯¹è±¡ï¼Œå¹¶å‡†å¤‡å¥½Requestå’ŒResponseWriterçš„ç›¸å…³æ•°æ®è®¾ç½®åˆ°Contextä¸­å»ï¼Œæä¾›ç»™æ–¹æ³•é“¾è°ƒç”¨ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// è°ƒç”¨ä¸­é—´ä»¶å’Œè¯·æ±‚é€»è¾‘å‡½æ•°
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Engine</span>) <span style="color:#a6e22e">handleHTTPRequest</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Context</span>) {
    <span style="color:#a6e22e">httpMethod</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">Method</span>
    <span style="color:#a6e22e">rPath</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">Path</span>
    <span style="color:#a6e22e">unescape</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">false</span>
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">UseRawPath</span> <span style="color:#f92672">&amp;&amp;</span> len(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">RawPath</span>) &gt; <span style="color:#ae81ff">0</span> {
        <span style="color:#a6e22e">rPath</span> = <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Request</span>.<span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">RawPath</span>
        <span style="color:#a6e22e">unescape</span> = <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">UnescapePathValues</span>
    }

    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">RemoveExtraSlash</span> {
        <span style="color:#a6e22e">rPath</span> = <span style="color:#a6e22e">cleanPath</span>(<span style="color:#a6e22e">rPath</span>)
    }

    <span style="color:#75715e">// è¿™é‡Œå¿…é¡»çŸ¥é“ginä½¿ç”¨çš„æ˜¯ â€œåŸºæ•°æ ‘ï¼ˆRadix Treeï¼‰â€ ç”¨äºå­˜å‚¨è·¯ç”±
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// https://michaelyou.github.io/2018/02/10/%E8%B7%AF%E7%94%B1%E6%9F%A5%E6%89%BE%E4%B9%8BRadix-Tree/
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">trees</span>
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">tl</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>, len(<span style="color:#a6e22e">t</span>); <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">tl</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">t</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">method</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">httpMethod</span> {
            <span style="color:#75715e">// ä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œengineä¸­çš„methodTrees []methodTreeæ˜¯è¯·æ±‚æ–¹æ³•åˆ†ç»„çš„è·¯ç”±åŒ¹é…æ ‘ã€‚
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">continue</span>
        }
        <span style="color:#a6e22e">root</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">t</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">root</span>
        <span style="color:#75715e">// rootæ•°æ®ç»“æ„ï¼ˆradix-treeï¼‰ï¼Ÿå¦‚ä½•æŸ¥æ‰¾ï¼Ÿ
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">root</span>.<span style="color:#a6e22e">getValue</span>(<span style="color:#a6e22e">rPath</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Params</span>, <span style="color:#a6e22e">unescape</span>) <span style="color:#75715e">// æ‰¾åˆ°è·¯ç”±å¯¹åº”çš„å¤„ç†å‡½æ•°
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">handlers</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
            <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">handlers</span> = <span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">handlers</span> <span style="color:#75715e">// å¤åˆ¶èŠ‚ç‚¹çš„æ‰€æœ‰handlers
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Params</span> = <span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">params</span>     <span style="color:#75715e">// è·¯ç”±å‚æ•°
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">fullPath</span> = <span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">fullPath</span> <span style="color:#75715e">// å…¨è·¯å¾„
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Next</span>()                    <span style="color:#75715e">// ä¾æ¬¡è°ƒç”¨HandlerChainä¸­çš„å‡½æ•°
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">writermem</span>.<span style="color:#a6e22e">WriteHeaderNow</span>()
            <span style="color:#66d9ef">return</span>
        }
        <span style="color:#75715e">// çœç•¥ï¼Œè¿™éƒ¨åˆ†æµç¨‹æ§åˆ¶ä¹Ÿè‡ªè¡Œé˜…è¯»
</span><span style="color:#75715e"></span>    }
    
    <span style="color:#75715e">// çœç•¥...
</span><span style="color:#75715e"></span>}
</code></pre></div><p>ä»ä¸Šè¿°æµç¨‹æˆ‘ä»¬å¯ä»¥æ€»ç»“å¾—åˆ°å›¾ä¸­ç´«è‰²éƒ¨åˆ†è°ƒç”¨é“¾ï¼š</p>
<p><em><strong>engine.Run -&gt; http.ListenAndServe -&gt; engine.handleHTTPRequest -&gt; c.Next</strong></em></p>
<p>ä½†æ˜¯å…¶ä¸­è¿˜æœ‰ä¸æ¸…æ¥šçš„é—®é¢˜ï¼š</p>
<ul>
<li>è·¯ç”±æ˜¯é€šè¿‡æ–¹æ³•ç¡®å®šåˆ°è¯¥æ–¹æ³•æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå†æŸ¥è¯¢åˆ°è·¯ç”±å¯¹åº”çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨radix-treeä¸­æ˜¯å¦‚ä½•è¿›è¡Œè·¯ç”±åŒ¹é…çš„å‘¢ï¼Ÿ</li>
<li>c.handlers ç›´æ¥ä»åŒ¹é…åˆ°çš„è·¯ç”±èŠ‚ç‚¹çš„handlerså¤åˆ¶å¾—åˆ°ï¼Œé‚£ä¹ˆä¸­é—´ä»¶æ˜¯å¦‚ä½•æŒ‚åœ¨åˆ°å…¶ä¸­çš„å‘¢ï¼Ÿ</li>
<li>è·å–åˆ°c.handlersä¹‹åï¼Œåªè°ƒç”¨äº†ä¸€æ¬¡c.Nextï¼Œé‚£ä¹ˆè¯¥é“¾è·¯æ˜¯å¦‚ä½•ç»§ç»­è°ƒç”¨ä¸‹å»çš„ï¼Ÿ</li>
<li>Path Paramæ˜¯å¦‚ä½•è·å–åˆ°ï¼Ÿ<strong>root.getValue</strong></li>
</ul>
<h3 id="routergroup--methodtree">RouterGroup &amp; MethodTree</h3>
<p>è¿™éƒ¨åˆ†æ˜¯é™¤äº†Contextæ¦‚å¿µä¹‹å¤–ç†è§£ginçš„ç¬¬äºŒæ ¸å¿ƒéƒ¨åˆ†ï¼Œæä¾›è·¯ç”±æ³¨å†Œï¼Œè°ƒç”¨é“¾è·¯å‡½æ•°é“¾å¤„ç†ï¼Œè·¯ç”±åˆ†ç»„ï¼Œè·¯ç”±åŒ¹é…åŠŸèƒ½ã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œå¿…é¡»çŸ¥é“ginçš„è·¯ç”±æ˜¯ç”±httprouteræä¾›ï¼Œè€ŒhttprouteråŒ…æ˜¯ä½¿ç”¨äº†radix-treeæ¥å®ç°è·¯ç”±ç®¡ç†åŠŸèƒ½ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// IRouter defines all router handle interface includes single and group router.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">IRouter</span> <span style="color:#66d9ef">interface</span> {
	<span style="color:#a6e22e">IRoutes</span>
	<span style="color:#a6e22e">Group</span>(<span style="color:#66d9ef">string</span>, <span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">RouterGroup</span>
}

<span style="color:#75715e">// IRoutes defines all router handle interface.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">IRoutes</span> <span style="color:#66d9ef">interface</span> {
	<span style="color:#a6e22e">Use</span>(<span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#a6e22e">IRoutes</span>

	<span style="color:#a6e22e">Handle</span>(<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">string</span>, <span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#a6e22e">IRoutes</span>
	<span style="color:#a6e22e">Any</span>(<span style="color:#66d9ef">string</span>, <span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#a6e22e">IRoutes</span>
	<span style="color:#a6e22e">GET</span>(<span style="color:#66d9ef">string</span>, <span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#a6e22e">IRoutes</span>
	<span style="color:#a6e22e">POST</span>(<span style="color:#66d9ef">string</span>, <span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#a6e22e">IRoutes</span>
	<span style="color:#a6e22e">DELETE</span>(<span style="color:#66d9ef">string</span>, <span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#a6e22e">IRoutes</span>
	<span style="color:#a6e22e">PATCH</span>(<span style="color:#66d9ef">string</span>, <span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#a6e22e">IRoutes</span>
	<span style="color:#a6e22e">PUT</span>(<span style="color:#66d9ef">string</span>, <span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#a6e22e">IRoutes</span>
	<span style="color:#a6e22e">OPTIONS</span>(<span style="color:#66d9ef">string</span>, <span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#a6e22e">IRoutes</span>
	<span style="color:#a6e22e">HEAD</span>(<span style="color:#66d9ef">string</span>, <span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#a6e22e">IRoutes</span>

	<span style="color:#a6e22e">StaticFile</span>(<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">string</span>) <span style="color:#a6e22e">IRoutes</span>
	<span style="color:#a6e22e">Static</span>(<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">string</span>) <span style="color:#a6e22e">IRoutes</span>
	<span style="color:#a6e22e">StaticFS</span>(<span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">FileSystem</span>) <span style="color:#a6e22e">IRoutes</span>
}

<span style="color:#75715e">// RouterGroup is used internally to configure router, a RouterGroup is associated with
</span><span style="color:#75715e">// a prefix and an array of handlers (middleware).
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RouterGroup</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Handlers</span> <span style="color:#a6e22e">HandlersChain</span> <span style="color:#75715e">// ä¸­é—´ä»¶
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">basePath</span> <span style="color:#66d9ef">string</span>        <span style="color:#75715e">// è·¯ç”±å‰ç¼€
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">engine</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">Engine</span>       <span style="color:#75715e">// æŒ‡å‘engineå…¥å£çš„æŒ‡é’ˆ
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">root</span>     <span style="color:#66d9ef">bool</span>          <span style="color:#75715e">// æ˜¯å¦æ˜¯root
</span><span style="color:#75715e"></span>}
</code></pre></div><h4 id="è·¯ç”±æ³¨å†Œ">.è·¯ç”±æ³¨å†Œ</h4>
<p>é€šè¿‡ä»»æ„ä¸€ä¸ªè·¯ç”±æ³¨å†Œæ–¹æ³•ï¼Œéƒ½å¯ä»¥è¿›å…¥åˆ° <code>func (group *RouterGroup) handle(httpMethod, relativePath string, handlers HandlersChain) IRoutes</code> è¿™ä¸ªæ–¹æ³•ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// æŒ‚è½½è·¯ç”±çš„å®é™…å¤„ç†å‡½æ•°
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">group</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RouterGroup</span>) <span style="color:#a6e22e">handle</span>(<span style="color:#a6e22e">httpMethod</span>, <span style="color:#a6e22e">relativePath</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">handlers</span> <span style="color:#a6e22e">HandlersChain</span>) <span style="color:#a6e22e">IRoutes</span> {
	<span style="color:#75715e">// è®¡ç®—æœ€ç»ˆçš„ç»å¯¹è·¯å¾„ base + relativePath
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// æ³¨æ„baseä¹Ÿæ˜¯ç»å¯¹è·¯å¾„
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">absolutePath</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">calculateAbsolutePath</span>(<span style="color:#a6e22e">relativePath</span>)
	<span style="color:#75715e">// åˆå¹¶å¤„ç†å‡½æ•°ï¼Œå°†ä¸­é—´ä»¶å’Œé€»è¾‘å‡½æ•°ç»“åˆåœ¨ä¸€èµ·
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// ä¸€èˆ¬æ¥è¯´è¿™é‡Œä¼ å…¥çš„handlderæ˜¯é€»è¾‘å‡½æ•° len(handlers) = 1
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// åªæœ‰å°‘æ•°çš„handlerä¼šæœ‰è‡ªå·±çš„ä¸­é—´ä»¶å¤„ç†å‡½æ•° len(handlers) &gt; 1
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">handlers</span> = <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">combineHandlers</span>(<span style="color:#a6e22e">handlers</span>)
	<span style="color:#75715e">// å°†å¤„ç†å¥½çš„ HandlersChain åŠ è½½åˆ°Radix Treeä¸­å»
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// è¿™ä¹Ÿè¡¨æ˜ï¼Œè¿™é‡Œçš„RouterGroupåªä¼šè½½å¤„ç†è·¯ç”±æ—¶å‘æŒ¥ä½œç”¨
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">engine</span>.<span style="color:#a6e22e">addRoute</span>(<span style="color:#a6e22e">httpMethod</span>, <span style="color:#a6e22e">absolutePath</span>, <span style="color:#a6e22e">handlers</span>)
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">returnObj</span>()
}
</code></pre></div><blockquote>
<p>engineåœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šè®¾ç½®RouterGroup.basePath = &ldquo;/&rdquo;
engineæ˜¯å°†ç›¸åŒè¯·æ±‚æ–¹æ³•æŒ‚è½½åˆ°åŒä¸€æ£µæ ‘ä¸‹</p>
</blockquote>
<p>çœ‹åˆ°è¿™é‡Œå›åˆ°engine.addRouteä¸­å»ï¼Œé€šè¿‡æ·±å…¥å‘ç°å¦‚ä¸‹è°ƒç”¨é“¾ï¼š</p>
<p><em><strong>engine.GET -&gt; routergroup.GET -&gt; routergroup.handle -&gt; engine.addRoute -&gt; methodTree.addRoute -&gt; node(radix-tree&rsquo;s node).insertChild</strong></em></p>
<h4 id="è·¯ç”±åˆ†ç»„">.è·¯ç”±åˆ†ç»„</h4>
<p>RouterGroupé€šè¿‡Groupå‡½æ•°æ¥è¡ç”Ÿä¸‹ä¸€çº§åˆ«çš„RouterGroupï¼Œä¼šæ‹·è´çˆ¶çº§RouterGroupçš„ä¸­é—´ä»¶ï¼Œé‡æ–°è®¡ç®—basePathã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">group</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RouterGroup</span>) <span style="color:#a6e22e">Group</span>(<span style="color:#a6e22e">relativePath</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">handlers</span> <span style="color:#f92672">...</span><span style="color:#a6e22e">HandlerFunc</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">RouterGroup</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">RouterGroup</span>{
		<span style="color:#a6e22e">Handlers</span>: <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">combineHandlers</span>(<span style="color:#a6e22e">handlers</span>),           <span style="color:#75715e">// åˆå§‹åŒ–æ—¶ï¼Œæ‹·è´çˆ¶äº²èŠ‚ç‚¹çš„ä¸­é—´ä»¶
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">basePath</span>: <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">calculateAbsolutePath</span>(<span style="color:#a6e22e">relativePath</span>), <span style="color:#75715e">// åˆå§‹åŒ–æ—¶ï¼Œè®¡ç®—å­©å­groupçš„ç»å¯¹è·¯å¾„
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">engine</span>:   <span style="color:#a6e22e">group</span>.<span style="color:#a6e22e">engine</span>,
	}
}
</code></pre></div><h4 id="ä¸­é—´ä»¶æŒ‚è½½">.ä¸­é—´ä»¶æŒ‚è½½</h4>
<p>æœ‰ä¸¤ä¸ªåœ°æ–¹æä¾›ç»™ä¸­é—´ä»¶æŒ‚è½½ï¼Œä¸€ä¸ªæ˜¯RouterGroup.Useé›†ä¸­æŒ‚è½½ä¸­é—´ä»¶ï¼›å¦ä¸€ä¸ªåœ°æ–¹æ˜¯æŒ‚è½½ç‰¹å®šè·¯ç”±çš„æ—¶å€™(RouterGroup.GET / POST ç­‰ç­‰)ï¼Œå°†ä¸­é—´ä»¶å’Œé€»è¾‘å¤„ç†å‡½æ•°ä¸€èµ·æŒ‚è½½ã€‚ç¬¬äºŒç§æ–¹å¼åœ¨è·¯ç”±æ³¨å†Œçš„æ—¶å€™å·²ç»è§è¿‡äº†ï¼Œè¿™é‡Œå†è¯´ä¸‹Useæ–¹æ³•ï¼Œ<code>RouterGroup.Handlers = append(RouterGroup.Handlers, middlewareHandlers)</code>ï¼Œè¿™é‡Œåªæ˜¯ç®€å•çš„å°†åæ¥çš„ä¸­é—´ä»¶å¤åˆ¶åˆ°RouterGroupçš„ä¸­é—´ä»¶ä¸Šï¼Œæ²¡æœ‰å…¶ä»–çš„é€»è¾‘ã€‚</p>
<h4 id="è·¯ç”±åŒ¹é…">.è·¯ç”±åŒ¹é…</h4>
<p>è¿™éƒ¨åˆ†å…¨éƒ½æ˜¯äº¤ç”±radix-treeæ¥è´Ÿè´£çš„éƒ¨åˆ†ã€‚</p>
<h3 id="handlerfunc">HandlerFunc</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">HandlerFunc</span> <span style="color:#66d9ef">func</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">Context</span>)  <span style="color:#75715e">// å¤„ç†å‡½æ•°ç­¾å  
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">HandlersChain</span> []<span style="color:#a6e22e">HandlerFunc</span> <span style="color:#75715e">// å¤„ç†å‡½æ•°é“¾
</span></code></pre></div><p>è¿™éƒ¨åˆ†æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯å®šä¹‰äº†å‡½æ•°ç­¾åï¼ŒæŒ‡å®šContextä½œä¸ºä¸Šä¸‹æ–‡ä¼ é€’çš„å…³é”®æ•°æ®ã€‚</p>
<h3 id="context">Context</h3>
<p>Contextæ˜¯ä¸Šä¸‹æ–‡ä¼ é€’çš„æ ¸å¿ƒï¼Œå®ƒåŒ…æ‹¬äº†è¯·æ±‚å¤„ç†ï¼Œå“åº”å¤„ç†ï¼Œè¡¨å•è§£æç­‰é‡è¦å·¥ä½œã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Context is the most important part of gin. It allows us to pass variables between middleware,
</span><span style="color:#75715e">// manage the flow, validate the JSON of a request and render a JSON response for example.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Context</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">writermem</span> <span style="color:#a6e22e">responseWriter</span> <span style="color:#75715e">// å®ç°äº†http.ResponseWriter å’Œ gin.ResponseWriter
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Request</span>   <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>  <span style="color:#75715e">// http.Request, æš´éœ²ç»™handler
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// gin.ResponseWriter åŒ…å«äº†ï¼š
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// http.ResponseWriterï¼Œhttp.Hijackerï¼Œhttp.Flusherï¼Œhttp.CloseNotifierå’Œé¢å¤–æ–¹æ³•
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// æš´éœ²ç»™handlerï¼Œæ˜¯writermmçš„å¤åˆ¶
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Writer</span>    <span style="color:#a6e22e">ResponseWriter</span> 

    <span style="color:#a6e22e">Params</span>   <span style="color:#a6e22e">Params</span>        <span style="color:#75715e">// è·¯å¾„å‚æ•° 
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">handlers</span> <span style="color:#a6e22e">HandlersChain</span> <span style="color:#75715e">// è°ƒç”¨é“¾
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">index</span>    <span style="color:#66d9ef">int8</span>          <span style="color:#75715e">// å½“å‰handlerçš„ç´¢å¼•
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fullPath</span> <span style="color:#66d9ef">string</span>

    <span style="color:#a6e22e">engine</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Engine</span> <span style="color:#75715e">// å¯¹engineçš„å¼•ç”¨
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Keys</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{} <span style="color:#75715e">// c.GET / c.SET çš„æ”¯æŒï¼Œå¸¸ç”¨äºsessionä¼ é€’ã€‚
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// Errors is a list of errors attached to all the handlers/middlewares who used this context.
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Errors</span> <span style="color:#a6e22e">errorMsgs</span>

    <span style="color:#75715e">// Accepted defines a list of manually accepted formats for content negotiation.
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Accepted</span> []<span style="color:#66d9ef">string</span>

    <span style="color:#75715e">// query å‚æ•°ç¼“å­˜
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">queryCache</span> <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">Values</span>
    <span style="color:#75715e">// è¡¨å•å‚æ•°ç¼“å­˜, è·ŸqueryCacheä½œç”¨ç±»ä¼¼
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">formCache</span> <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">Values</span>
}
</code></pre></div><h4 id="è°ƒç”¨é“¾æµè½¬å’Œæ§åˆ¶">.è°ƒç”¨é“¾æµè½¬å’Œæ§åˆ¶</h4>
<p>ä»Engineéƒ¨åˆ†å·²ç»çŸ¥é“ï¼Œå½“è·¯ç”±è¢«åŒ¹é…åˆ°ä¹‹åä¼šæ‰§è¡Œä¸€æ¬¡c.Nextï¼ŒNexté€»è¾‘éå¸¸ç®€å•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Context</span>) <span style="color:#a6e22e">Next</span>() {
    <span style="color:#75715e">// ä»c.reset å¯ä»¥çŸ¥é“ c.index == -1
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">index</span><span style="color:#f92672">++</span>
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">index</span> &lt; int8(len(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">handlers</span>)) {
        <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">handlers</span>[<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">index</span>](<span style="color:#a6e22e">c</span>) <span style="color:#75715e">// å‘ç”Ÿè°ƒç”¨
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">index</span><span style="color:#f92672">++</span>
    }
}

<span style="color:#75715e">// 63ï¼Œè¿™æ„å‘³è¿™å¦‚æœæœ€å¤§é“¾è·¯è¶…è¿‡äº†63ï¼Œé‚£ä¹ˆé€šè¿‡indexçš„æµç¨‹æ§åˆ¶å°±å‡ºé—®é¢˜äº†ã€‚
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">abortIndex</span> <span style="color:#66d9ef">int8</span> = <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">MaxInt8</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> 

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Context</span>) <span style="color:#a6e22e">Abort</span>() {
    <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">index</span> = <span style="color:#a6e22e">abortIndex</span>
}
</code></pre></div><p>è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½ åœ¨è°ƒç”¨é“¾ä¸­çš„æŸä¸€ä¸ªhandlerä¸­è°ƒç”¨äº†c.Abortä¹‹ç±»çš„å‡½æ•°ï¼Œè°ƒç”¨é“¾ä¼šç›´æ¥é€€å‡ºä¹Ÿæ˜¯é€šè¿‡c.indexæ¥æ§åˆ¶çš„ã€‚é™¤äº†è°ƒç”¨é“¾æµè½¬ï¼Œåœ¨Contextè¿™ä¸€éƒ¨åˆ†è¿˜æ¯”è¾ƒé‡è¦çš„æ˜¯ï¼Œå‚æ•°çš„è§£æï¼Œå“åº”å¤„ç†ã€‚</p>
<h4 id="å‚æ•°è§£æ">.å‚æ•°è§£æ</h4>
<p>å‚æ•°ä¼ é€’ä¸€å…±æœ‰ä¸€ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<table>
<thead>
<tr>
<th>åºå·</th>
<th>å‚æ•°ç±»å‹</th>
<th>è§£é‡Š</th>
<th>Contextæ”¯æŒ</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>path param</td>
<td>åœ¨URIä¸­å°†å‚æ•°ä½œä¸ºè·¯å¾„çš„ä¸€éƒ¨åˆ†</td>
<td>c.Param(&ldquo;key&rdquo;) string</td>
</tr>
<tr>
<td>2</td>
<td>query param</td>
<td>åœ¨URIä¸­ä»¥&quot;?&ldquo;å¼€å§‹çš„ï¼Œ&ldquo;key=value&quot;å½¢å¼çš„éƒ¨åˆ†</td>
<td>c.Query(&ldquo;key&rdquo;) string</td>
</tr>
<tr>
<td>3</td>
<td>body [form; json; xmlç­‰ç­‰]</td>
<td>æ ¹æ®è¯·æ±‚å¤´Content-Typeåˆ¤å®šæˆ–æŒ‡å®š</td>
<td>c.Bindç±»ä¼¼å‡½æ•°</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Content-Type MIME of the most common data formats.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> (
    <span style="color:#a6e22e">MIMEJSON</span>              = <span style="color:#e6db74">&#34;application/json&#34;</span>
    <span style="color:#a6e22e">MIMEHTML</span>              = <span style="color:#e6db74">&#34;text/html&#34;</span>
    <span style="color:#a6e22e">MIMEXML</span>               = <span style="color:#e6db74">&#34;application/xml&#34;</span>
    <span style="color:#a6e22e">MIMEXML2</span>              = <span style="color:#e6db74">&#34;text/xml&#34;</span>
    <span style="color:#a6e22e">MIMEPlain</span>             = <span style="color:#e6db74">&#34;text/plain&#34;</span>
    <span style="color:#a6e22e">MIMEPOSTForm</span>          = <span style="color:#e6db74">&#34;application/x-www-form-urlencoded&#34;</span>
    <span style="color:#a6e22e">MIMEMultipartPOSTForm</span> = <span style="color:#e6db74">&#34;multipart/form-data&#34;</span>
    <span style="color:#a6e22e">MIMEPROTOBUF</span>          = <span style="color:#e6db74">&#34;application/x-protobuf&#34;</span>
    <span style="color:#a6e22e">MIMEMSGPACK</span>           = <span style="color:#e6db74">&#34;application/x-msgpack&#34;</span>
    <span style="color:#a6e22e">MIMEMSGPACK2</span>          = <span style="color:#e6db74">&#34;application/msgpack&#34;</span>
    <span style="color:#a6e22e">MIMEYAML</span>              = <span style="color:#e6db74">&#34;application/x-yaml&#34;</span>
)
</code></pre></div><blockquote>
<p>å…³äºç¬¬ä¸‰ç§å‚æ•°è§£ææ˜¯æœ€å¸¸ç”¨çš„ï¼Œä¹Ÿæ˜¯æœ€å¤æ‚çš„éƒ¨åˆ†åŒ…å«çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚åˆ«å¿˜äº†ï¼Œbindingçš„åŒæ—¶è¿˜æœ‰å‚æ•°æ ¡éªŒæ˜¯åŸºäºâ€œgithub.com/go-playground/validatorâ€å®ç°çš„ã€‚</p>
</blockquote>
<h4 id="å“åº”å¤„ç†">.å“åº”å¤„ç†</h4>
<p>å¸¸ç”¨çš„å“åº”æ–¹æ³•æœ‰<code>c.String(http.Status, string)</code>, <code>c.JSON(http.Status, interface{})</code></p>
<p><em><strong>c.Render(code http.Status, r gin.Render) -&gt; r.Render</strong></em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Render interface is to be implemented by JSON, XML, HTML, YAML and so on.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Render</span> <span style="color:#66d9ef">interface</span> {
	<span style="color:#75715e">// Render writes data with custom ContentType.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">Render</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>) <span style="color:#66d9ef">error</span>
	<span style="color:#75715e">// WriteContentType writes custom ContentType.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">WriteContentType</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>)
}
</code></pre></div><p>è¿™é‡Œä»¥gin.render.JSONä¸ºä¾‹ï¼š</p>
<blockquote>
<p>è¿™é‡ŒjsonåŒ…å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨çš„æ ‡å‡†åº“jsonï¼Œè€Œæ˜¯ç»è¿‡äº†ä¸€å±‚åŒ…è£…ç”¨äºæ”¯æŒjsoniteræ›¿æ¢jsonã€‚
è¿™ä¸€æ”¯æŒæ˜¯åŸºäºgolangé€‰æ‹©æ€§ç¼–è¯‘å®ç°çš„ã€‚</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Render (JSON) writes data with custom ContentType.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">r</span> <span style="color:#a6e22e">JSON</span>) <span style="color:#a6e22e">Render</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>) (<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">WriteJSON</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Data</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#66d9ef">return</span>
}

<span style="color:#75715e">// WriteContentType (JSON) writes JSON ContentType.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">r</span> <span style="color:#a6e22e">JSON</span>) <span style="color:#a6e22e">WriteContentType</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>) {
	<span style="color:#a6e22e">writeContentType</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">jsonContentType</span>)
}

<span style="color:#75715e">// WriteJSON marshals the given interface object and writes it with custom ContentType.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">WriteJSON</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">obj</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#66d9ef">error</span> {
	<span style="color:#a6e22e">writeContentType</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">jsonContentType</span>)
	<span style="color:#a6e22e">encoder</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">NewEncoder</span>(<span style="color:#a6e22e">w</span>)
	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">encoder</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">obj</span>)
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
}
</code></pre></div><h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>è¿™é‡ŒçŸ¥è¯†è®²äº†æŠŠginä½œä¸ºAPI Serverå¼€å‘æ—¶å¸¸ç”¨åˆ°çš„ä¸»è¦æµç¨‹å’Œæ•°æ®ç»“æ„ï¼Œå…¶ä¸­æ›´å¤šçš„æµç¨‹æ§åˆ¶éƒ¨åˆ†è¢«çœç•¥äº†ï¼Œå¯ä»¥è‡ªè¡Œç»“åˆä»£ç å’Œæºç é˜…è¯»ã€‚è¿™é‡Œä¸»è¦è§£æäº†ginä¸­å‡½æ•°è°ƒç”¨é“¾è·¯å’Œhandlersæµç¨‹æ§åˆ¶ï¼Œ<em><strong>RadixTree</strong></em>çš„éƒ¨åˆ†éƒ½è¢«çœç•¥äº†ï¼Œç®—æ³•èœé¸¡ä¸æ•¢ä¹±è¯´ï¼ŒæŒæ¡åå†ç»“åˆginçš„æºç é‡è¯»ã€‚</p>
<p>æ–‡ä¸­ä»£ç åå¤šï¼Œæœ€å¥½æ˜¯ç»“åˆæºç å’Œå›¾ç‰‡é£Ÿç”¨ã€‚</p>
<blockquote>
<p>æ°´å¹³æœ‰é™ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿å‹˜è¯¯æŒ‡æ­£ğŸ™ã€‚</p>
</blockquote>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<ul>
<li><a href="https://michaelyou.github.io/2018/02/10/%E8%B7%AF%E7%94%B1%E6%9F%A5%E6%89%BE%E4%B9%8BRadix-Tree/">https://michaelyou.github.io/2018/02/10/%E8%B7%AF%E7%94%B1%E6%9F%A5%E6%89%BE%E4%B9%8BRadix-Tree/</a></li>
</ul>


                            
                            
                            
                            
                            
                        </section>

					</div>

                    

<footer id="footer">
    
    <section>
      <form method="post" action="post-action">
        <div class="fields">
          <div class="field">
            <label for="name">Name</label>
            <input type="text" name="name" id="name" />
          </div>
          <div class="field">
            <label for="email">Email</label>
            <input type="text" name="email" id="email" />
          </div>
          <div class="field">
            <label for="message">Message</label>
            <textarea name="message" id="message" rows="3"></textarea>
          </div>
        </div>
        <ul class="actions">
          <li><input type="submit" value='Send A Message' /></li>
        </ul>
      </form>
    </section>
    
    <section class="split contact">
        
        <section class="alt">
            <h3>Address</h3>
            <p>
                
                     Chengdu Â· China
                
                     <br/>  This is a city that comes and doesn&#39;t want to go
                
            </p>
        </section>
        
        
        <section>
            <h3>Phone</h3>
            <p><a href="tel:no%20way">no way</a></p>
        </section>
        
        
        <section>
            <h3>Email</h3>
            <p><a href="mailto:yeqown@gmail.com">yeqown@gmail.com</a></p>
        </section>
        
        
        <section>
            <h3>Social</h3>
            <ul class="icons alt">
                
                <li><a href="https://twitter.com/yeqown" class="icon alt fa-twitter"><span class="label">Twitter</span></a></li>
                
                
                
                
                
                <li><a href="https://github.com/yeqown" class="icon alt fa-github"><span class="label">GitHub</span></a></li>
                
                
                
                
                
            </ul>
        </section>
        
    </section>
</footer>

                    
<div id="copyright">
    <ul><li>&copy; Yeqown</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li><li>Hugo Port: <a href="https://curtistimson.co.uk">curttimson</a></li></ul>
</div>


            </div>
            
            










<script src='/assets/js/bundle.js'></script>
	</body>
</html>
